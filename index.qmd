---
title: "Poverty Data Gaps"
---

{{< include OJS/filters.qmd >}}

::: {.panel-tabset}

## Data gaps

```{ojs}
modal = html`<div id="modal-overlay">
  <div id="modal-content">
    <button id="modal-close">X</button>
    <div id="modal-body"></div>
  </div>
</div>`

// Helper functions for modal
function showModal(rowData) {
  const overlay = document.getElementById('modal-overlay');
  const modalBody = document.getElementById('modal-body');
  
  modalBody.innerHTML = `
    <h2>${rowData.Name}</h2>
    
    <div style="margin-bottom: 1rem;">
      <strong>Headline finding:</strong> ${rowData.Headline || 'No description available'}
    </div>
    
    <div style="margin-bottom: 1rem;">
      <strong>Research Questions:</strong> ${rowData.Questions || 'No description available'}
    </div>
    
    <div style="margin-bottom: 1rem;">
      <strong>Impact:</strong> ${rowData.Impact || 'No description available'}
    </div>
    
    <div style="margin-bottom: 1rem;">
      <strong>Sources:</strong> ${rowData.Sources || 'No description available'}
    </div>
    
    <div style="margin-bottom: 1rem;">
      <strong>Topics:</strong> ${rowData.Topics_Text || 'No description available'}
    </div>
    
    <div style="margin-bottom: 1rem;">
      <strong>Types of Gap:</strong> ${rowData.Type || 'No description available'}
    </div>
    
    <div style="background: #f5f5f5; padding: 1rem; border-radius: 4px;">
      <strong>${rowData.Report}</strong>
      <p>${rowData.Author || 'No author available'} (${rowData.Date}) </p>
      <a href=${rowData.URL} target=_blank>View Report</a>
    </div>
    
  `;
  
  overlay.style.display = 'flex';
}

function hideModal() {
  const overlay = document.getElementById('modal-overlay');
  if (overlay) overlay.style.display = 'none';
}

// Set up close handlers after modal is rendered
{
  setTimeout(() => {
    const closeBtn = document.getElementById('modal-close');
    const overlay = document.getElementById('modal-overlay');
    
    if (closeBtn) {
      closeBtn.addEventListener('click', hideModal);
    }
    
    if (overlay) {
      overlay.addEventListener('click', (e) => {
        if (e.target.id === 'modal-overlay') hideModal();
      });
    }
  }, 100);
}
```


::: {.ojs-table .gaps-table}

```{ojs}
viewof gaps_table = Inputs.table(filtered_gaps, {
  columns: ["Name", "Type", "Sources", "Topics", "Link"], 
  header: {
    Type: "Type of Data Gap",
  },
  sort: false,
  format: {
    Link: (testValue, row_index) => {
      const div = document.createElement('div');
      div.innerHTML = testValue;
      
      const button = div.querySelector('button');
      if (button) {
        button.addEventListener('click', () => {
          const rowData = filtered_gaps[row_index];
          showModal(rowData);
        });
      }
      
      return div;
    }
  },
  rows: 20
})
```

:::

## Reports

::: {.ojs-table .reports-table}

```{ojs}
modal2 = html`<div id="modal-overlay2">
  <div id="modal-content2">
    <button id="modal-close2">X</button>
    <div id="modal-body2"></div>
  </div>
</div>`

// Helper functions for modal
function showReportsModal(rowData) {
  const overlay2 = document.getElementById('modal-overlay2');
  const modalBody2 = document.getElementById('modal-body2');
  
  modalBody2.innerHTML = `
    <h2>${rowData.Title}</h2>
    
    <div style="margin-bottom: 1rem;">
      ${rowData.Author} (${rowData.Date})
    </div>

    <div style="background: #f5f5f5; padding: 1rem; border-radius: 4px;">
      ${rowData.GapText}
    </div>

    
  `;
  
  overlay2.style.display = 'flex';
}

function hideReportsModal() {
  const overlay2 = document.getElementById('modal-overlay2');
  if (overlay2) overlay2.style.display = 'none';
}

// Set up close handlers after modal is rendered
{
  setTimeout(() => {
    const closeBtn2 = document.getElementById('modal-close2');
    const overlay2 = document.getElementById('modal-overlay2');
    
    if (closeBtn2) {
      closeBtn2.addEventListener('click', hideReportsModal);
    }
    
    if (overlay2) {
      overlay2.addEventListener('click', (e) => {
        if (e.target.id === 'modal-overlay2') hideReportsModal();
      });
    }
  }, 100);
}
```


```{ojs}
viewof reports_table = Inputs.table(filtered_reports, {
  columns: ["Title", "Author", "Date", "URL", "Link"], 
  sort: false,
  format: {
    Link: (testValue, row_index) => {
      const div = document.createElement('div');
      div.innerHTML = testValue;
      
      const button = div.querySelector('button');
      if (button) {
        button.addEventListener('click', () => {
          const rowData = filtered_reports[row_index];
          showReportsModal(rowData);
        });
      }
      
      return div;
    },
    URL: Test => {
      const div = document.createElement('div');
      div.innerHTML = Test;
      return div;
    }
  },
  rows: 20
})
```

:::

:::

```{ojs}
// Read in data
data_gaps = FileAttachment("data/data_gaps_table.csv").csv({ typed: true })
data_reports = FileAttachment("data/reports_table.csv")
  .csv({ typed: true })
  .then(data => data.map(d => ({ ...d, Date: String(d.Date) })))
```

```{ojs}
// Dropdown options
sources_opts = FileAttachment("data/sources_opts.csv").csv({ typed: true })
types_opts = FileAttachment("data/types_opts.csv").csv({ typed: true })
topics_opts = FileAttachment("data/topics_opts.csv").csv({ typed: true })
```

```{ojs}
// Filter data
filtered_gaps = data_gaps.filter(function(x) {
  if (sources.length > 0 && !sources.some(s => x.Sources.includes(s))) return false;
  if (types.length > 0 && !types.some(t => x.Type.includes(t))) return false;
  if (topics.length > 0 && !topics.some(topic => x.Topics.includes(topic))) return false;
  return true;
})
filtered_reports = data_reports.filter(function(x) {
  if (sources.length > 0 && !sources.some(s => x.Sources.includes(s))) return false;
  if (types.length > 0 && !types.some(t => x.Type.includes(t))) return false;
  if (topics.length > 0 && !topics.some(topic => x.Topics.includes(topic))) return false;
  return true;
})
```

